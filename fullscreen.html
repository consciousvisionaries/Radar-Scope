<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Radar Scope</title>
<style>
   

.city-highlighted {
  color: #ff0; /* Highlight color */
}

  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    display: flex;
    background-color: black;
    color: #0f0;
    font-family: monospace;
  }
  #feed {
  width: 33.33%;
  height: 100vh;
  overflow: auto;
  font-size: 16px;
  padding: 10px;
  box-sizing: border-box;
  padding-bottom: 100px; /* Add some padding to the bottom */
}

  #radarContainer {
    flex-grow: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #radar {
    position: relative;
    height: 80vh;
    width: 80vh;
    border-radius: 50%;
    border: 5px solid #0f0;
  }
  #sweep {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  /* Define a conic-gradient with a sharp leading edge that fades out */
  background: conic-gradient(
    rgba(0, 255, 0, 0.0) 0%,
    rgba(0, 255, 0, .7) 25%, /* Start of the main beam */
    rgba(0, 255, 0, 0.4) 15%, /* Begin fading after the main beam */
    rgba(0, 255, 0, 0.0) 0% /* Fully faded */
  );
  animation: sweep 4s linear infinite;
}

  .city, .label {
    transition: opacity 1s ease-out; /* Smooth transition for fading to complete invisibility */
    opacity: 0; /* Start invisible */
  }
  .city {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #ff0;
    transform: translate(-50%, -50%);
  }
  .label {
    position: absolute;
    color: #ff0;
    font-size: 12px;
    white-space: nowrap;
    text-shadow: 1px 1px 1px #000;
  }
  @keyframes sweep {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
</style>
</head>
<body>
    <audio id="beepSound" src="beep.wav" preload="auto"></audio>

<div id="feed">Major Cities:</div>
<div id="radarContainer">
  <div id="radar">
    <div id="sweep"></div>
  </div>
</div>
<script>
const cities = [
  { name: "New York", latitude: 40.7128, longitude: -74.0060 },
  { name: "London", latitude: 51.5074, longitude: -0.1278 },
  { name: "Tokyo", latitude: 35.6895, longitude: 139.6917 },
  { name: "Sydney", latitude: -33.8688, longitude: 151.2093 },
  { name: "Moscow", latitude: 55.7558, longitude: 37.6173 },
  // Additional cities provided
  
  { name: "Salmon Arm", latitude: 50.7001, longitude: -119.2837 },
  // More cities can be added here.
];


const radar = document.getElementById('radar');
const feed = document.getElementById('feed');

function plotCities() {
  const radarRadius = radar.offsetWidth / 2;
  cities.forEach(city => {
    const angleRadians = Math.atan2(city.latitude, city.longitude) + Math.PI / 2; // Adjust for radar's 0 at top
    const distanceFromCenter = radarRadius * (1 - Math.abs(city.latitude) / 90); // Simplify for demo
    const x = radarRadius + distanceFromCenter * Math.cos(angleRadians);
    const y = radarRadius + distanceFromCenter * Math.sin(angleRadians);

    // City Marker
    const marker = document.createElement('div');
    marker.className = 'city';
    marker.style.left = `${x}px`;
    marker.style.top = `${y}px`;
    radar.appendChild(marker);

    // City Label
    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = city.name;
    label.style.left = `${x}px`;
    label.style.top = `${y + 30}px`; // Offset for visibility
    radar.appendChild(label);

    // Store for animation
    city.marker = marker;
    city.label = label;
  });
}

function updateFeed() {
  cities.forEach(city => {
    feed.innerHTML += `${city.name} (${city.latitude.toFixed(2)}, ${city.longitude.toFixed(2)})<br>`;
  });
}

let sweepAngle = 0;
let lastUpdateTime = Date.now();

const beepSound = document.getElementById('beepSound'); // Get the beep sound element

// Function to play the first second of the beep sound
function playBeepSound() {
    beepSound.currentTime = 0; // Start from the beginning
    beepSound.play().catch(e => console.error("Failed to play sound:", e));

    // Stop the sound after 1 second
    setTimeout(() => {
        beepSound.pause(); // Stop playback
        beepSound.currentTime = 0; // Reset position (optional, for readiness for next play)
    }, 1000); // 1000 milliseconds = 1 second
}



function animateRadar() {
  const now = Date.now();
  const deltaTime = now - lastUpdateTime;
  sweepAngle += (deltaTime / 4000) * 360; // Adjust based on actual time elapsed
  sweepAngle %= 360; // Keep sweepAngle within 0-360 degrees
  lastUpdateTime = now;

  cities.forEach(city => {
    const angleRadians = Math.atan2(city.latitude, city.longitude) + Math.PI / 2;
    const cityAngle = (angleRadians * (180 / Math.PI) + 360) % 360;

    let adjustedSweepAngle = sweepAngle; // Adjust sweep angle by 45 degrees
    adjustedSweepAngle %= 360; // Ensure within 0-360 degrees

    let deltaAngle = Math.abs(adjustedSweepAngle - cityAngle);
    deltaAngle = deltaAngle > 180 ? 360 - deltaAngle : deltaAngle;

    // Determine if the city should be highlighted based on the sweep angle
    if (deltaAngle < 5 && !city.highlightStarted) {
      city.marker.style.opacity = 1;
      city.label.style.opacity = 1;
      city.highlightStarted = true; // Mark highlight start

      //playBeepSound(); // Call this function where you need the beep sound to play

          // Add city name to feed
          feed.innerHTML += `${city.name} (${city.latitude.toFixed(2)}, ${city.longitude.toFixed(2)})<br>`;
      
      // Schedule fade out after 0.25 seconds
      setTimeout(() => {
        city.marker.style.transition = 'opacity 1s ease-out';
        city.label.style.transition = 'opacity 1s ease-out';
        city.marker.style.opacity = 1;
        city.label.style.opacity = 1;
      }, 0);

      // Reset state after 0.5 seconds
      setTimeout(() => {
        city.highlightStarted = false;
        city.marker.style.transition = 'opacity 1s ease-out';
        city.label.style.transition = 'opacity 1s ease-out';
        city.marker.style.opacity = 0;
        city.label.style.opacity = 0;
      }, 2000);
    }
  });

  requestAnimationFrame(animateRadar);
}



document.addEventListener('DOMContentLoaded', () => {
  plotCities();
  updateFeed();
  animateRadar();
});
</script>
</body>
</html>
